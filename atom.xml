<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-04-14T06:39:26.942Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¼€å§‹å­¦ä¹  kubernetes</title>
    <link href="http://example.com/posts/f38c21ef.html"/>
    <id>http://example.com/posts/f38c21ef.html</id>
    <published>2024-04-14T06:39:03.000Z</published>
    <updated>2024-04-14T06:39:26.942Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»æˆ‘åœ¨è‡ªå·±çš„ ubuntu ç³»ç»Ÿä¸Šæ­å»º kubernetes å­¦ä¹ ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œåœ¨é˜…è¯»äº†ä¸€äº›æ–‡æ¡£ä¹‹åï¼Œæˆ‘å¤§è‡´å°†æŒ‰ç…§ä»¥ä¸‹æ¸…å•æ¥é€æ­¥æ­å»ºä¸€ä¸ªæœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼Œéƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomcat å®ä¾‹ã€‚</p><ol><li>å®‰è£… kubectl ä»¥ä¾¿åç»­å¯åŠ¨æœ¬åœ°æµ‹è¯•é›†ç¾¤åå¯ä»¥é€šè¿‡ kubectl è®¿é—®</li><li>ä½¿ç”¨ podman æä¾›å®¹å™¨æœåŠ¡</li><li>é€šè¿‡ kind åˆå§‹åŒ–å¹¶å¯åŠ¨ä¸€ä¸ª k8s é›†ç¾¤</li><li>éƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomecat å®ä¾‹</li></ol><h2 id="å®‰è£…-kubectl"><a class="markdownIt-Anchor" href="#å®‰è£…-kubectl"></a> å®‰è£… kubectl</h2><p>å®‰è£…æ–¹æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/</a></p><pre class="highlight"><code class="bash">curl -LO <span class="hljs-string">"https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl"</span></code></pre><p>éªŒè¯ä¸€ä¸‹å®‰è£…åŒ…ï¼š</p><pre class="highlight"><code class="bash">curl -LO <span class="hljs-string">"https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl.sha256"</span><span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(cat kubectl.sha256)</span>  kubectl"</span> | <span class="hljs-built_in">sha256sum</span> --check</code></pre><p>å¦‚æœå®‰è£…åŒ…æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œå°†è¾“å‡º <code>kubectl: OK</code>ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><pre class="highlight"><code class="bash">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</code></pre><p>å¯ä»¥æ‰§è¡Œ <code>kubectl version --client</code> æ£€æŸ¥ä¸‹å®‰è£…ç‰ˆæœ¬ã€‚</p><h2 id="å®‰è£…-podman"><a class="markdownIt-Anchor" href="#å®‰è£…-podman"></a> å®‰è£… podman</h2><p>ubuntu 22.04 ä¸‹é€šè¿‡ apt åœ¨å®‰è£… podman çš„ç‰ˆæœ¬æ˜¯ 3.4.4ï¼Œè¿™ä¸ªç‰ˆæœ¬å¤ªæ—§äº†ï¼Œä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œé€šè¿‡æŸ¥ç½‘ä¸Šçš„èµ„æ–™å‘ç° homebrew ä¹Ÿæ”¯æŒ ubuntu ç³»ç»Ÿï¼Œæ‰€ä»¥è·Ÿç€ homebrew çš„å®‰è£…æŒ‡å¼•å…ˆæŠŠ homebrew å®‰è£…äº†ï¼Œç„¶åå†é€šè¿‡ homebrew å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ podmanã€‚</p><blockquote><p>è¿™ä¸ªå®‰è£…è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œå›½å†…ä½¿ç”¨ brew çš„è¯è¿˜æ˜¯éœ€è¦ç½‘ç»œåŠ é€Ÿæ‰èƒ½æœ‰ç¨å¾®å¥½çš„ä¸‹è½½ä½“éªŒï¼Œå¦‚æœä½ æœ‰å·¥å…·çš„è¯ï¼Œå¯ä»¥åœ¨ç»ˆç«¯æ‰§è¡Œ <code>export https_proxy=...</code> ä¸ºç»ˆç«¯åŠ ä¸ŠåŠ é€Ÿä»£ç†</p></blockquote><pre class="highlight"><code class="bash">brew install podman</code></pre><p>å®‰è£…å®Œæˆä¹‹åï¼Œæ³¨æ„çœ‹ brew çš„å®‰è£…æç¤ºï¼Œæˆ‘æ²¡æœ‰é€‰æ‹©ä½¿ podman éšç³»ç»Ÿå¯åŠ¨ï¼Œ</p><pre class="highlight"><code class="">zsh completions have been installed to:  /home/linuxbrew/.linuxbrew/share/zsh/site-functionsTo start podman now and restart at login:  brew services start podmanOr, if you don't want/need a background service you can just run:  /home/linuxbrew/.linuxbrew/opt/podman/bin/podman system service --time\=0</code></pre><blockquote><p>æˆ‘æ‰‹åŠ¨å¯åŠ¨ podmanï¼Œå‡ºç° newuidmap æ²¡æœ‰å¯æ‰§è¡Œçš„æ–‡ä»¶çš„çš„é”™è¯¯ <code>exec: "newuidmap": executable file not found in $PATH</code>ï¼Œé€šè¿‡ <code>sudo apt-get install uidmap</code> è§£å†³</p></blockquote><p>é€šè¿‡å¯åŠ¨ä¸€ä¸ª hello-world æ¥æµ‹è¯• podman ä»¥åŠæ­£ç¡®å®‰è£…ï¼Œ</p><pre class="highlight"><code class="bash">podman run hello-world</code></pre><p>å®ƒä¼šä» <a href="http://docker.io">docker.io</a> æ‹‰å– hello-world é•œåƒå¹¶è¿è¡Œï¼Œä¸å‡ºæ„å¤–ç»ˆç«¯å°†è¾“å‡ºä¸€äº›è¡¨ç¤ºå®‰è£…æˆåŠŸçš„ä¿¡æ¯ï¼Œæ¯”å¦‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œå¦‚ä¸‹</p><pre class="highlight"><code class="">Hello from Docker!This message shows that your installation appears to be working correctly.To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.    (amd64) 3. The Docker daemon created a new container from that image which runs the    executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it    to your terminal.</code></pre><h3 id="é—®é¢˜å’Œè§£å†³åŠæ³•"><a class="markdownIt-Anchor" href="#é—®é¢˜å’Œè§£å†³åŠæ³•"></a> é—®é¢˜å’Œè§£å†³åŠæ³•</h3><ol><li><p><code>failed to find plugin "bridge"</code><br>å¯ä»¥é€šè¿‡ <code>sudo apt install containernetworking-plugins</code> è§£å†³ï¼Œä½†è¿˜æ˜¯è€é—®é¢˜ï¼Œè¿™ä¸ªå®‰è£…ä¸‹æ¥çš„ç‰ˆæœ¬æ˜¯<code>0.9</code>ï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©ä» github ä¸‹è½½æœ€æ–°çš„ release æ‰‹åŠ¨å®‰è£…ï¼Œä»ä»£ç  <a href="https://github.com/containers/common/blob/main/pkg/config/default.go#L83">https://github.com/containers/common/blob/main/pkg/config/default.go#L83</a> ä¸­å¯ä»¥çœ‹åˆ° podman ä»ä»¥ä¸‹ç›®å½•è·å– cni æ’ä»¶:</p><pre class="highlight"><code class="go">DefaultCNIPluginDirs = []<span class="hljs-type">string</span>{<span class="hljs-string">"/usr/local/libexec/cni"</span>,<span class="hljs-string">"/usr/libexec/cni"</span>,<span class="hljs-string">"/usr/local/lib/cni"</span>,<span class="hljs-string">"/usr/lib/cni"</span>,<span class="hljs-string">"/opt/cni/bin"</span>,  }</code></pre><p>å› æ­¤ä» github ä¸‹è½½æœ€æ–°çš„ release ä¹‹åï¼Œè§£å‹åˆ°ä»¥ä¸Šä»»æ„ç›®å½•å³å¯ã€‚</p><pre class="highlight"><code class="bash">sudo <span class="hljs-built_in">mkdir</span> -p /usr/local/libexec/cnisudo tar -xzf ./Downloads/cni-plugins-linux-amd64-v1.4.0.tgz -C /usr/local/libexec/cni</code></pre><p>è§£å‹ä¹‹åï¼Œæ‰§è¡Œ <code>podman system reset --force</code>åˆ·æ–°ä¸€ä¸‹ã€‚</p></li><li><p><code>failed to find plugin "dnsname"</code><br><a href="https://github.com/containers/dnsname?tab=readme-ov-file">dnsname</a> è¿™ä¸ªé¡¹ç›®å·²ç»ä¸å†ç»´æŠ¤äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<a href="https://github.com/containers/netavark/">netavark</a>ï¼ŒåŒæ—¶åœ¨å‰é¢çœ‹åˆ°çš„ podman ä»£ç é‡Œæˆ‘ä»¬åŒæ ·å¯ä»¥çœ‹åˆ°æœ€æ–°çš„ podman æ”¯æŒ netavarkï¼Œ</p><pre class="highlight"><code class="go"> DefaultNetavarkPluginDirs = []<span class="hljs-type">string</span>{   <span class="hljs-string">"/usr/local/libexec/netavark"</span>,   <span class="hljs-string">"/usr/libexec/netavark"</span>,   <span class="hljs-string">"/usr/local/lib/netavark"</span>,   <span class="hljs-string">"/usr/lib/netavark"</span>, }</code></pre><p>é‚£ä¹ˆç´¢æ€§æˆ‘ä»¬å°±ç”¨æœ€æ–°çš„æ–¹æ¡ˆã€‚åœ¨ netavark é¡¹ç›®ä¸‹æ‰¾åˆ°æœ€æ–°çš„ release æ–‡ä»¶ï¼Œä¸‹è½½å¹¶è§£å‹åˆ° <code>/usr/local/libexec/netavark</code>ï¼Œ</p><pre class="highlight"><code class="bash">sudo <span class="hljs-built_in">mkdir</span> -p /usr/local/libexec/netavarksudo gzip -d ./netavark.gzsudo <span class="hljs-built_in">cp</span> -fr netavark /usr/local/libexec/netavarksudo <span class="hljs-built_in">chmod</span> +x /usr/local/libexec/netavark/netavark</code></pre><p>ä¸ºäº†è®© podman èƒ½ä½¿ç”¨ netavarkï¼Œéœ€è¦ä½œä¸ªé…ç½®ï¼Œé…ç½®å‚è€ƒï¼š<a href="https://github.com/containers/common/blob/main/docs/containers.conf.5.md%EF%BC%8C%E6%88%91%E9%80%89%E6%8B%A9%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%60$HOME/.config/containers/containers.conf%60%E5%B9%B6%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8A%A0%E5%85%A5%E4%B8%80%E8%A1%8C%E9%85%8D%E7%BD%AE:">https://github.com/containers/common/blob/main/docs/containers.conf.5.mdï¼Œæˆ‘é€‰æ‹©åˆ›å»ºæ–‡ä»¶`$HOME/.config/containers/containers.conf`å¹¶åœ¨å…¶ä¸­åŠ å…¥ä¸€è¡Œé…ç½®:</a></p><pre class="highlight"><code class="ini"><span class="hljs-attr">network_backend</span>=<span class="hljs-string">"netavark"</span></code></pre></li></ol><p>kind é»˜è®¤ä½¿ç”¨ docker ä½œä¸ºå®¹å™¨å¼•æ“ï¼Œä¸ºäº†ä½¿ kind èƒ½ä½¿ç”¨ podmanï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸‹ shellï¼Œæˆ‘ä½¿ç”¨ zshï¼Œå› æ­¤åœ¨ .zshrc ä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p><pre class="highlight"><code class="bash"><span class="hljs-comment"># kind with podman</span><span class="hljs-built_in">alias</span> docker=podmanKIND_EXPERIMENTAL_PROVIDER=podman</code></pre><h2 id="å®‰è£…-kind"><a class="markdownIt-Anchor" href="#å®‰è£…-kind"></a> å®‰è£… kind</h2><p>é¦–å…ˆè¦å®‰è£… kindï¼Œkind ä¹Ÿæ˜¯ä¸€ä¸ª go é¡¹ç›®ï¼Œå®‰è£…æ–¹å¼æ˜¯é€šè¿‡<code>go get</code>ï¼Œæ‰€ä»¥å®‰è£… kind ä¹‹å‰éœ€è¦é¦–å…ˆå®‰è£… go å¹¶å®Œæˆç›¸åº”çš„è®¾ç½®ã€‚</p><p>åŒæ ·å¯ä»¥é€šè¿‡ apt æ¥å®‰è£… goï¼Œæˆ‘æ˜¯ä»å®˜ç½‘ä¸‹è½½ go çš„å®‰è£…åŒ…å®‰è£…çš„ï¼Œæ— è®ºå¦‚ä½•å®‰è£…ï¼Œä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„è®¾ç½®æ˜¯<code>GOPROXY</code>ã€‚</p><pre class="highlight"><code class="bash">go <span class="hljs-built_in">env</span> -w GOPROXY=https://goproxy.cn,direct</code></pre><p>ç„¶åå°±å¯ä»¥å®‰è£… kind äº†ï¼Œ</p><pre class="highlight"><code class="bash">go install sigs.k8s.io/kind@v0.20.0</code></pre><p>go ä¼šå°† kind ä»¥åŠç›¸å…³çš„ä¾èµ–å…¨éƒ¨å®‰è£…åˆ° GOPATH ä¸‹ï¼Œè€Œ GOPATH é»˜è®¤å°±æ˜¯ä½  HOME ç›®å½•ä¸‹çš„ go æ–‡ä»¶å¤¹ï¼Œå¯ä»¥é€šè¿‡<code>go env GOPATH</code>æ¥æŸ¥çœ‹ï¼Œå¯ä»¥åœ¨<code>.bashrc</code>æˆ–è€…<code>.zshrc</code>ä¸­åŠ å…¥ä¸€è¡Œï¼š</p><pre class="highlight"><code class="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HOME</span>/go/bin</code></pre><p>é‡å¯ç»ˆç«¯å·¥å…·ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨ kind å‘½ä»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ <code>kind version</code> æµ‹è¯•ä¸€ä¸‹ã€‚</p><h2 id="kind-åˆä½“éªŒ"><a class="markdownIt-Anchor" href="#kind-åˆä½“éªŒ"></a> kind åˆä½“éªŒ</h2><p>é€šè¿‡<code>kind --help</code>å¯ä»¥å¤§è‡´æµè§ˆä¸‹ kind æœ‰å“ªäº›å‘½ä»¤é€‰é¡¹å¯ç”¨ã€‚</p><pre class="highlight"><code class="">kind creates and manages local Kubernetes clusters using Docker container 'nodes'Usage:  kind [command]Available Commands:  build       Build one of [node-image]  completion  Output shell completion code for the specified shell (bash, zsh or fish)  create      Creates one of [cluster]  delete      Deletes one of [cluster]  export      Exports one of [kubeconfig, logs]  get         Gets one of [clusters, nodes, kubeconfig]  help        Help about any command  load        Loads images into nodes  version     Prints the kind CLI versionFlags:  -h, --help              help for kind      --loglevel string   DEPRECATED: see -v instead  -q, --quiet             silence all stderr output  -v, --verbosity int32   info log verbosity, higher value produces more output      --version           version for kindUse "kind [command] --help" for more information about a command.</code></pre><blockquote><p>è¿™é‡Œæœ‰æ„æ€çš„æ˜¯é€šè¿‡ <code>kind completion</code> å¯ä»¥çœ‹åˆ°ä¸åŒç»ˆç«¯ä¸‹å‘½ä»¤è‡ªåŠ¨å¡«å……çš„æ–¹æ³•ï¼Œå»ºè®®è·Ÿç€è¯´æ˜é…ç½®ä¸€ä¸‹ï¼Œåœ¨ç»ˆç«¯ä¸‹è¾“å…¥ç›¸å…³å‘½ä»¤å¯ä»¥è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p></blockquote><p>è¿™ä¸ªæ—¶å€™ä½¿ç”¨<code>kind get clusters</code>å¯ä»¥çœ‹åˆ°å‘½ä»¤ kind å·²ç»ä½¿ç”¨ podman ä½œä¸ºå®¹å™¨å¼•æ“å¹¶ä¸”ç›®å‰è¿˜æ²¡æœ‰ä»»ä½•é›†ç¾¤ã€‚</p><pre class="highlight"><code class="">enabling experimental podman providerNo kind clusters found.</code></pre><p>ä¸ºäº†ä»¥æ™®é€šè´¦æˆ·è¿è¡Œ kindï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€äº›é…ç½®ï¼Œæˆ‘å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kind.sigs.k8s.io/docs/user/rootless/">https://kind.sigs.k8s.io/docs/user/rootless/</a> è¿›è¡Œé…ç½®ä½†æ— æ³•æˆåŠŸåˆ›å»ºé›†ç¾¤ã€‚é”™è¯¯å¦‚ä¸‹ï¼š</p><pre class="highlight"><code class="bash">(base) âœ  ~ kind create clusterenabling experimental podman providerERROR: failed to create cluster: running kind with rootless provider requires setting systemd property <span class="hljs-string">"Delegate=yes"</span>, see https://kind.sigs.k8s.io/docs/user/rootless/</code></pre><p>æˆ‘æš‚æ—¶è¿˜ä¸å¤ªæ‡‚<code>systemd</code>é‚£å¥—ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ²¡æœ‰è°ƒæŸ¥æ¸…é™¤è¿™ä¸ªé—®é¢˜çš„åŸå› ï¼Œæˆ‘æƒ³æœªæ¥å†å¯¹ systemd è¿›è¡Œç³»ç»Ÿæ€§çš„å­¦ä¹ ï¼Œç°åœ¨é¦–è¦å·¥ä½œæ˜¯è§£å†³ kind åˆ›å»ºé›†ç¾¤çš„é—®é¢˜ã€‚æˆ‘åœ¨æŸ¥é˜…äº†ç½‘ä¸Šå¾ˆå¤šæ–‡æ¡£ä¹‹ååœ¨è¿™é‡Œæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚<a href="https://github.com/kubernetes-sigs/kind/issues/2916">Running with rootless podman seems not to respect property Delegate=yes</a></p><p>ä¼¼ä¹æŒ‰ç…§ kind æ–‡æ¡£ä¸­è¯´çš„åœ¨<code>/etc/systemd/system/user@.service.d/delegate.conf</code>æ–‡ä»¶ä¸­é…ç½®çš„<code>Delegate=yes</code>æ²¡æœ‰ç”Ÿæ•ˆï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºé›†ç¾¤æ—¶åŠ ä¸Š<code>--property=Delegate=yes</code>å‚æ•°ï¼Œå³</p><pre class="highlight"><code class="bash">systemd-run --user --property=Delegate=<span class="hljs-built_in">yes</span> kind create cluster</code></pre><p>ç°åœ¨ç»ˆäºå¯ä»¥çœ‹åˆ°ç†æƒ³çš„ç»“æœäº†ï¼š</p><pre class="highlight"><code class="">(base) âœ  ~ systemd-run --scope  --user --property=Delegate=yes kind create clusterRunning as unit: run-r3e7e2ade31574b7ba03fece7b1b70d02.scope; invocation ID: 82c73452ecb240be9fc5f8cad084b879enabling experimental podman providerCreating cluster "kind" ... âœ“ Ensuring node image (kindest/node:v1.27.3) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾Set kubectl context to "kind-kind"You can now use your cluster with:kubectl cluster-info --context kind-kindHave a nice day! ğŸ‘‹</code></pre><p>ä»è¿™ä¸ªè¾“å‡ºä¿¡æ¯çœ‹ä¸ä»…åˆ›å»ºäº†ä¸€ä¸ªåä¸º kind çš„é›†ç¾¤ï¼Œè¿˜ä¸ºæˆ‘ä»¬æŠŠ kubectl ä¹Ÿé…ç½®å¥½äº†ï¼Œç°åœ¨å¯ä»¥æ£€æŸ¥ä¸‹ã€‚</p><pre class="highlight"><code class="">(base) âœ  ~ kind get clustersenabling experimental podman providerkind(base) âœ  ~ kind get nodesenabling experimental podman providerkind-control-plane(base) âœ  ~ kubectl get nodeNAME                 STATUS   ROLES           AGE    VERSIONkind-control-plane   Ready    control-plane   7m7s   v1.27.3</code></pre><h2 id="åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤"><a class="markdownIt-Anchor" href="#åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤"></a> åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤</h2><p>ä¸€ä¸ªæµ‹è¯•é›†ç¾¤æ€ä¹ˆè¯´ä¹Ÿè‡³å°‘è¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª yaml æ–‡ä»¶é…ç½®é›†ç¾¤ã€‚</p><pre class="highlight"><code class="yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">Cluster</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kind.x-k8s.io/v1alpha4</span><span class="hljs-attr">name:</span> <span class="hljs-string">kindtest</span><span class="hljs-attr">nodes:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">control-plane</span>    <span class="hljs-attr">kubeadmConfigPatches:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">|        kind: InitConfiguration        nodeRegistration:          kubeletExtraArgs:            node-labels: "ingress-ready=true"</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">worker</span></code></pre><p>æ‰§è¡Œ kind åˆ›å»ºé›†ç¾¤çš„å‘½ä»¤</p><pre class="highlight"><code class="bash">systemd-run --scope  --user --property=Delegate=<span class="hljs-built_in">yes</span> kind create cluster --config=./kindtest.yaml</code></pre><p>ç¨å¾®ç­‰å¾…è¿‡å kind ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºåŒ…å«ä¸€ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œé€šè¿‡ <code>kubectl get nodes</code> æ£€æŸ¥ä¸€ä¸‹:</p><pre class="highlight"><code class="bash">âœ  Devops kubectl get nodesNAME                     STATUS   ROLES           AGE   VERSIONkindtest-control-plane   Ready    control-plane   18m   v1.27.3kindtest-worker          Ready    &lt;none&gt;          18m   v1.27.3</code></pre><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å½“å‰é›†ç¾¤æœ‰é‚£äº› podï¼Œæˆ‘é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŠŠ pod çš„ namespace/name/nodeName è¾“å‡ºæ¥</p><pre class="highlight"><code class="bash">kubectl get pods -A -o jsonpath=<span class="hljs-string">"{range .items[*]}{.metadata.namespace}{'\t'}{.metadata.name}{'\t'}{.spec.nodeName}{'\n'}{end}"</span></code></pre><p>è¾“å‡ºç»“æœ:</p><pre class="highlight"><code class="">kube-systemcoredns-5d78c9869d-n6qjrkindtest-control-planekube-systemcoredns-5d78c9869d-v9bkmkindtest-control-planekube-systemetcd-kindtest-control-planekindtest-control-planekube-systemkindnet-8r4h8kindtest-control-planekube-systemkindnet-n4d6jkindtest-workerkube-systemkube-apiserver-kindtest-control-planekindtest-control-planekube-systemkube-controller-manager-kindtest-control-planekindtest-control-planekube-systemkube-proxy-bksh8kindtest-control-planekube-systemkube-proxy-vzv5pkindtest-workerkube-systemkube-scheduler-kindtest-control-planekindtest-control-planelocal-path-storagelocal-path-provisioner-6bc4bddd6b-8w9jvkindtest-control-plane</code></pre><p>é€šè¿‡è¿™äº›è¾“å‡ºå¯ä»¥äº†è§£åˆ°èŠ‚ç‚¹<code>kindtest-control-plane</code> åŒ…å«äº† k8s è¿è¡Œçš„å¿…è¦ç»„å»ºåŒ…æ‹¬ apiserver, etcd, kubeproxy, kube-scheduler ç­‰ã€‚</p><h2 id="éƒ¨ç½²-tomcat"><a class="markdownIt-Anchor" href="#éƒ¨ç½²-tomcat"></a> éƒ¨ç½² tomcat</h2><p>åœ¨åˆ›å»º depleymnent ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª namespaceï¼Œ</p><pre class="highlight"><code class="bash">kubectl create namespace k8slearn</code></pre><p>ç„¶åå‡†å¤‡ deployment é…ç½®ï¼Œå¹¶æ‰§è¡Œ<code>kubectl apply -f ./k8slearn-tomcatapp-deployment.yaml</code></p><pre class="highlight"><code class="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">get-started-with-k8s</span>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">k8slearn</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>  <span class="hljs-attr">selector:</span>    <span class="hljs-attr">matchLabels:</span>      <span class="hljs-attr">app:</span> <span class="hljs-string">k8slearn</span>  <span class="hljs-attr">template:</span>    <span class="hljs-attr">metadata:</span>      <span class="hljs-attr">labels:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">k8slearn</span>    <span class="hljs-attr">spec:</span>      <span class="hljs-attr">containers:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">tomcat</span>          <span class="hljs-attr">name:</span> <span class="hljs-string">main</span>          <span class="hljs-attr">ports:</span>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span></code></pre><p>ä¸å‡ºæ„å¤–ï¼Œç¨ç­‰ä¸€ä¼šå„¿ä¸€ä¸ªpodå°±ä¼šåˆ›å»ºå‡ºæ¥ã€‚</p><pre class="highlight"><code class="bash">(base) âœ  kubectl get pod -n k8slearn                                              NAME                                    READY   STATUS    RESTARTS   AGEget-started-with-k8s-6487fc8787-tp5bh   1/1     Running   0          6m25s</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»æˆ‘åœ¨è‡ªå·±çš„ ubuntu ç³»ç»Ÿä¸Šæ­å»º kubernetes å­¦ä¹ ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œåœ¨é˜…è¯»äº†ä¸€äº›æ–‡æ¡£ä¹‹åï¼Œæˆ‘å¤§è‡´å°†æŒ‰ç…§ä»¥ä¸‹æ¸…å•æ¥é€æ­¥æ­å»ºä¸€ä¸ªæœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼Œéƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomcat å®ä¾‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£… kubectl ä»¥ä¾¿åç»­å¯åŠ¨æœ¬åœ°æµ‹è¯•é›†ç¾¤åå¯ä»¥</summary>
      
    
    
    
    <category term="äº‘åŸç”Ÿ" scheme="http://example.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="kubernetes" scheme="http://example.com/tags/kubernetes/"/>
    
    <category term="ubuntu" scheme="http://example.com/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>get started with rust</title>
    <link href="http://example.com/posts/8ca469cd.html"/>
    <id>http://example.com/posts/8ca469cd.html</id>
    <published>2024-04-10T01:02:44.000Z</published>
    <updated>2024-04-10T01:02:51.093Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h2><blockquote><p>Rustup æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ï¼Œå®ƒæ˜¯ Rust çš„å·¥å…·é“¾ç®¡ç†å™¨ï¼Œè´Ÿè´£å®‰è£…ã€æ›´æ–°å’Œç®¡ç† Rust å·¥å…·é“¾ã€‚å·¥å…·é“¾åŒ…æ‹¬ç¼–è¯‘å™¨ã€æ ‡å‡†åº“ã€æ–‡æ¡£ã€å·¥å…·ä»¥åŠå…¶ä»–ä¸ Rust å¼€å‘ç›¸å…³çš„ç»„ä»¶ã€‚rustup æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œé€šè¿‡å®ƒå¯ä»¥è½»æ¾åœ°å®‰è£…å’Œä½¿ç”¨ Rustã€‚æ­¤å¤–ï¼Œrustup è¿˜å¯ä»¥å®‰è£…å’Œæ›´æ–°å…¶ä»– Rust å·¥å…·ï¼Œå¦‚ cargoã€Rust æ–‡æ¡£å·¥å…·ç­‰ã€‚åŒæ—¶ï¼Œrustup ä¹Ÿèƒ½å¤Ÿåœ¨ä¸åŒç‰ˆæœ¬çš„ Rust å·¥å…·é“¾ä¸­è¿›è¡Œåˆ‡æ¢ï¼ŒåŒ…æ‹¬ç¼–è¯‘å™¨ rustc å’Œæ ‡å‡†åº“ã€‚</p></blockquote><p>åœ¨ macos ä¸Šå®‰è£… rustup éå¸¸ç®€å•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨å‘å¯¼æŒ‡å¼•ä¸‹å°±èƒ½å®Œæˆå®‰è£…ï¼Œ</p><pre class="highlight"><code class="bash">brew install rustup-init</code></pre><p>å®‰è£…æˆåŠŸåå¯ä»¥æ‰§è¡Œ<code>rustc --version</code> æŸ¥çœ‹å®‰è£…å¥½çš„ rust ç‰ˆæœ¬ä¿¡æ¯ã€‚å¦‚ï¼š</p><pre class="highlight"><code class="bash">(base) âœ  Codes rustc --versionrustc 1.75.0 (82e1608df 2023-12-21)</code></pre><p>åŒæ—¶ï¼Œcargo ä¹Ÿå®‰è£…å¥½äº†ï¼Œ</p><pre class="highlight"><code class="bash">(base) âœ  Codes cargo --versioncargo 1.75.0 (1d8b05cdd 2023-11-20)</code></pre><blockquote><p>Cargo æ˜¯ä¸€ä¸ªå®˜æ–¹çš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å™¨ã€‚å®ƒæ˜¯ Rust ç”Ÿæ€ç³»ç»Ÿä¸­ç”¨äºæ„å»ºå’Œè¿è¡Œ Rust åº”ç”¨ç¨‹åºçš„æ ‡å‡†å·¥å…·ã€‚Cargo æå¤§åœ°ç®€åŒ–äº†é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ï¼Œæä¾›äº†ä¾èµ–é¡¹ç®¡ç†ï¼Œä»¥åŠä¸€ç³»åˆ—æ–¹ä¾¿çš„å·¥ä½œæµç¨‹å·¥å…·ï¼Œæå¤§æå‡äº†å¼€å‘æ•ˆç‡å’Œåä½œä½“éªŒã€‚</p></blockquote><h2 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world"></a> Hello World</h2><p>åœ¨ä»»æ„ä¸€ä¸ªç›®å½•ä¸‹ï¼Œåˆ›å»º <a href="http://main.rs">main.rs</a> æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="highlight"><code class="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"hello world"</span>)}</code></pre><p>ç„¶åæ‰§è¡Œç¼–è¯‘å¹¶è¿è¡Œç¨‹åºï¼Œ</p><pre class="highlight"><code class="bash">rustc ./main.rs./main</code></pre><h2 id="ä½“éªŒ-cargo"><a class="markdownIt-Anchor" href="#ä½“éªŒ-cargo"></a> ä½“éªŒ Cargo</h2><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸Šä¸€èŠ‚çš„ç¨‹åºæŒ‰ç…§ cargo é¡¹ç›®çš„æ ‡å‡†ç›®å½•ç»“æ„è¿›è¡Œè°ƒæ•´ï¼Œå‡è®¾é¡¹ç›®è·¯å¾„ä¸º<code>${project}</code></p><ol><li>æ–°å»º<code>${project}/src</code>ç›®å½•å¹¶ä¸”æŠŠ<code>main.rs</code>ç§»åŠ¨åˆ°è¿™ä¸ªç›®å½•</li><li>æ–°å»ºä¸€ä¸ª<code>${project}/Cargo.toml</code>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ol><pre class="highlight"><code class="toml"><span class="hljs-section">[package]</span><span class="hljs-attr">name</span> = <span class="hljs-string">"hello-world"</span><span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span><span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span><span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span><span class="hljs-section">[dependencies]</span></code></pre><p>æ­¤æ—¶åœ¨<code>${project}</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>cargo build</code>ï¼Œcargo ä¼šè°ƒç”¨ç›¸åº”çš„å·¥å…·è¿›è¡Œç¼–è¯‘ï¼Œä½ å°†åœ¨ç›®å½•ä¸‹çœ‹åˆ°æ–°ç”Ÿæˆçš„ target ç›®å½•ï¼Œå…¶ä¸­å°±åŒ…å«äº†å·²ç»ç¼–è¯‘å¥½çš„ hello-world äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼š</p><pre class="highlight"><code class="bash">git:(main) âœ— ./target/debug/hello-worldhello world</code></pre><p>å¦å¤–é€šè¿‡ cargo ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œå¦‚ä¸‹ï¼š</p><pre class="highlight"><code class="bash">git:(main) âœ— cargo run    Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword">in</span> 0.00s     Running `target/debug/hello-world`hello world</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å®‰è£…&quot;&gt;&lt;/a&gt; å®‰è£…&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Rustup æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ï¼Œå®ƒæ˜¯ Rust çš„å·¥å…·é“¾ç®¡ç†å™¨ï¼Œè´Ÿè´£å®‰è£…ã€æ›´æ–°å’Œç®¡ç† Rust å·¥å…·é“¾ã€‚å·¥å…·é“¾åŒ…æ‹¬ç¼–è¯‘</summary>
      
    
    
    
    <category term="ç¨‹åº" scheme="http://example.com/categories/%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="rust" scheme="http://example.com/tags/rust/"/>
    
  </entry>
  
  <entry>
    <title>Go Tips 1</title>
    <link href="http://example.com/posts/6063fc3b.html"/>
    <id>http://example.com/posts/6063fc3b.html</id>
    <published>2024-04-10T00:14:30.000Z</published>
    <updated>2024-04-10T00:15:21.492Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ•°ç»„å’Œåˆ‡ç‰‡"><a class="markdownIt-Anchor" href="#æ•°ç»„å’Œåˆ‡ç‰‡"></a> æ•°ç»„å’Œåˆ‡ç‰‡</h2><ol><li><p>åˆå§‹åŒ–æ•°ç»„æ—¶å¯ä»¥é€šè¿‡ç´¢å¼•æ¥æŒ‡å®šå€¼ï¼Œå¹¶ä¸”å¯ä»¥å’ŒæŒ‰é¡ºåºæŒ‡å®šå€¼æ··ç”¨</p><pre class="highlight"><code class="go"><span class="hljs-keyword">var</span> a [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>                    <span class="hljs-comment">// å®šä¹‰é•¿åº¦ä¸º 3 çš„ int å‹æ•°ç»„, å…ƒç´ å…¨éƒ¨ä¸º 0</span><span class="hljs-keyword">var</span> b = [...]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}       <span class="hljs-comment">// å®šä¹‰é•¿åº¦ä¸º 3 çš„ int å‹æ•°ç»„, å…ƒç´ ä¸º 1, 2, 3</span><span class="hljs-keyword">var</span> c = [...]<span class="hljs-type">int</span>{<span class="hljs-number">2</span>: <span class="hljs-number">3</span>, <span class="hljs-number">1</span>: <span class="hljs-number">2</span>}    <span class="hljs-comment">// å®šä¹‰é•¿åº¦ä¸º 3 çš„ int å‹æ•°ç»„, å…ƒç´ ä¸º 0, 2, 3</span><span class="hljs-keyword">var</span> d = [...]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>: <span class="hljs-number">5</span>, <span class="hljs-number">6</span>} <span class="hljs-comment">// å®šä¹‰é•¿åº¦ä¸º 6 çš„ int å‹æ•°ç»„, å…ƒç´ ä¸º 1, 2, 0, 0, 5, 6</span></code></pre></li><li><p><code>var times [5][0]int</code> ä¸ä¼šåˆå§‹åŒ–æ•°ç»„ï¼ˆæ²¡æœ‰å ç”¨å†…å­˜ç©ºé—´ï¼‰ï¼Œä½†æ˜¯å¯ä»¥éå†</p><pre class="highlight"><code class="go">    <span class="hljs-keyword">var</span> times [<span class="hljs-number">5</span>][<span class="hljs-number">0</span>]<span class="hljs-type">int</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> times {     fmt.Println(<span class="hljs-string">"hello"</span>) }</code></pre></li><li><p>å¦‚æœè¡ç”Ÿåˆ‡ç‰‡å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆåŸå§‹åˆ‡ç‰‡ï¼ˆæ•°ç»„ï¼‰ä»¥åŠå®ƒçš„æ‰€æœ‰çš„è¡ç”Ÿåˆ‡ç‰‡åœ¨å¯¹åº”ä½ç½®ä¸Šçš„å…ƒç´ éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› ä¸ºè¿™äº›åˆ‡ç‰‡éƒ½æŒ‡å‘äº†åŒä¸€ä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œæ²¡æœ‰åˆ†é…æ–°çš„ç©ºé—´ã€‚</p><pre class="highlight"><code class="go">a := []<span class="hljs-type">string</span>{<span class="hljs-string">"0"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>, <span class="hljs-string">"6"</span>}b := a[:<span class="hljs-number">5</span>]c := a[<span class="hljs-number">2</span>:]a[<span class="hljs-number">2</span>] = <span class="hljs-string">"a"</span>fmt.Println(<span class="hljs-string">"a="</span>, a)fmt.Println(<span class="hljs-string">"b="</span>, b)fmt.Println(<span class="hljs-string">"c="</span>, c)b[<span class="hljs-number">3</span>] = <span class="hljs-string">"b"</span>fmt.Println(<span class="hljs-string">"a="</span>, a)fmt.Println(<span class="hljs-string">"b="</span>, b)fmt.Println(<span class="hljs-string">"c="</span>, c)c[<span class="hljs-number">2</span>] = <span class="hljs-string">"c"</span>fmt.Println(<span class="hljs-string">"a="</span>, a)fmt.Println(<span class="hljs-string">"b="</span>, b)fmt.Println(<span class="hljs-string">"c="</span>, c)<span class="hljs-comment">// output</span><span class="hljs-comment">// a= [0 1 a 3 4 5 6]</span><span class="hljs-comment">// b= [0 1 a 3 4]</span><span class="hljs-comment">// c= [a 3 4 5 6]</span><span class="hljs-comment">// a= [0 1 a b 4 5 6]</span><span class="hljs-comment">// b= [0 1 a b 4]</span><span class="hljs-comment">// c= [a b 4 5 6]</span><span class="hljs-comment">// a= [0 1 a b c 5 6]</span><span class="hljs-comment">// b= [0 1 a b c]</span><span class="hljs-comment">// c= [a b c 5 6]</span></code></pre></li><li><p>åœ¨å¯¹åˆ‡ç‰‡è¿›è¡Œä¸€äº›æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç‰¹æ€§ 3 å°½å¯èƒ½çš„å°‘åˆ†é…å†…å­˜ã€‚</p><pre class="highlight"><code class="go">a := []<span class="hljs-type">int</span>{<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>}<span class="hljs-keyword">var</span> c []<span class="hljs-type">int</span>c = <span class="hljs-built_in">append</span>(c, a[:<span class="hljs-number">2</span>]...)c = <span class="hljs-built_in">append</span>(c, a[<span class="hljs-number">5</span>:]...)fmt.Println(a)fmt.Println(c)b := <span class="hljs-built_in">append</span>(a[:<span class="hljs-number">2</span>], a[<span class="hljs-number">5</span>:]...)fmt.Println(a)fmt.Println(b)<span class="hljs-comment">//output:</span><span class="hljs-comment">//[0 1 2 3 4 5 6]</span><span class="hljs-comment">//[0 1 5 6]</span><span class="hljs-comment">//[0 1 5 6 4 5 6]</span><span class="hljs-comment">//[0 1 5 6]</span></code></pre></li></ol><h2 id="å­—ç¬¦ä¸²"><a class="markdownIt-Anchor" href="#å­—ç¬¦ä¸²"></a> å­—ç¬¦ä¸²</h2><ol><li><p>é€šè¿‡ä¸‹æ ‡è·å–åˆ°çš„æ˜¯ä¸€ä¸ª <code>uint8</code> ç±»å‹çš„æ•°å­—ï¼ˆå­—èŠ‚ï¼‰</p></li><li><p>é€šè¿‡<code>for...range</code>éå†ï¼Œgo ä¼šåŠªåŠ›è§£ç æˆä¸€ä¸ªä¸€ä¸ªçš„<code>uint32</code>ï¼ˆå³<code>rune</code>ï¼‰ï¼Œç´¢å¼•åˆ™æ˜¯æ¯ä¸ª<code>rune</code>ç¬¬ä¸€ä¸ª byte åœ¨è¯¥å­—ç¬¦ä¸²å¯¹åº” byte æ•°ç»„ä¸­çš„ä½ç½®</p><pre class="highlight"><code class="go">s := <span class="hljs-string">"hello, ä¸–ç•Œ"</span><span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> s {fmt.Printf(<span class="hljs-string">"index:%d\t value:%v(%T)\n"</span>, i, v, v)}<span class="hljs-comment">// output:</span><span class="hljs-comment">// index:0  value:104(int32)</span><span class="hljs-comment">// index:1  value:101(int32)</span><span class="hljs-comment">// index:2  value:108(int32)</span><span class="hljs-comment">// index:3  value:108(int32)</span><span class="hljs-comment">// index:4  value:111(int32)</span><span class="hljs-comment">// index:5  value:44(int32)</span><span class="hljs-comment">// index:6  value:32(int32)</span><span class="hljs-comment">// index:7  value:19990(int32)</span><span class="hljs-comment">// index:10         value:30028(int32)</span></code></pre></li></ol><h2 id="ç»“æ„ä½“"><a class="markdownIt-Anchor" href="#ç»“æ„ä½“"></a> ç»“æ„ä½“</h2><ol><li><p>ç»“æ„ä½“çš„æ–¹æ³•å¯ä»¥è½¬æ¢ä¸ºå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆã€‚åŒç†æ¥å£ä¹Ÿä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯æ¥å£æœ¬èº«éšå«äº†æŒ‡é’ˆã€‚</p><pre class="highlight"><code class="go"><span class="hljs-keyword">var</span> f = (*Foo).SelfIntroducef(&amp;Foo{Name: <span class="hljs-string">"Tom"</span>}, <span class="hljs-string">"China"</span>)<span class="hljs-keyword">type</span> SelfIntroduce <span class="hljs-keyword">interface</span> {SelfIntroduce(where <span class="hljs-type">string</span>)}<span class="hljs-keyword">var</span> f = (SelfIntroduce).SelfIntroducef(&amp;Foo{Name: <span class="hljs-string">"Tom"</span>}, <span class="hljs-string">"China"</span>)</code></pre></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ•°ç»„å’Œåˆ‡ç‰‡&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æ•°ç»„å’Œåˆ‡ç‰‡&quot;&gt;&lt;/a&gt; æ•°ç»„å’Œåˆ‡ç‰‡&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ–æ•°ç»„æ—¶å¯ä»¥é€šè¿‡ç´¢å¼•æ¥æŒ‡å®šå€¼ï¼Œå¹¶ä¸”å¯ä»¥å’ŒæŒ‰é¡ºåºæŒ‡å®šå€¼æ··ç”¨&lt;/p&gt;
&lt;pre class=&quot;highli</summary>
      
    
    
    
    <category term="ç¨‹åº" scheme="http://example.com/categories/%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="go" scheme="http://example.com/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>useEffect infinite loop with dependencies</title>
    <link href="http://example.com/posts/f37b0db4.html"/>
    <id>http://example.com/posts/f37b0db4.html</id>
    <published>2023-11-17T22:10:47.000Z</published>
    <updated>2023-11-17T23:04:50.948Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰¯ä½œç”¨é’©å­useeffect"><a class="markdownIt-Anchor" href="#å‰¯ä½œç”¨é’©å­useeffect"></a> å‰¯ä½œç”¨é’©å­ï¼šuseEffect</h2><p>å½“éœ€è¦æ¯æ¬¡åœ¨ React ç»„ä»¶æ¸²æŸ“åæ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé’©å­æ¥æ³¨å†Œä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°<code>effect</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ React åœ¨ç¬¬ä¸€æ¬¡é¡µé¢æ¸²æŸ“ä¹‹åä»¥åŠåç»­é¡µé¢çš„æ¯æ¬¡æ›´æ–°åéƒ½ä¼šæ‰§è¡Œè¿™ä¸ª<code>effect</code>ã€‚</p><p>å¦å¤–ï¼Œå‰¯ä½œç”¨å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ŒReact ä¼šåœ¨å¸è½½ç»„ä»¶æ‰§è¡Œæ¸…é™¤æ“ä½œæ—¶å€™è°ƒç”¨è¿™ä¸ªè¿”å›çš„å‡½æ•°ï¼Œæ„å‘³ç€å¯ä»¥åœ¨å…¶ä¸­åŠ å…¥ä¸€äº›æ¸…ç†å·¥ä½œã€‚å®é™…ä¸Šï¼Œå› ä¸º React ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œ<code>effect</code>ï¼Œå®ƒä¼šåœ¨è°ƒç”¨ä¸€ä¸ªæ–°çš„<code>effect</code>ä¹‹å‰å¯¹å‰ä¸€ä¸ª<code>effect</code>è¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æœé¡µé¢å¦‚æœå‘ç”Ÿäº†æ¸²æŸ“ï¼Œæ¸…ç†ä¹Ÿä¼šå…ˆæ‰§è¡Œã€‚</p><p>useEffect çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ•°ç»„æŒ‡å®šä¾èµ–çš„æ•°æ®ï¼Œå½“è¿™äº›æ•°æ®å‘ç”Ÿäº†å˜åŒ–æ—¶æ‰æ‰§è¡Œ<code>effect</code>ã€‚</p><h2 id="æ— é™æ›´æ–°é—®é¢˜åˆ†æä»¥åŠè§£å†³"><a class="markdownIt-Anchor" href="#æ— é™æ›´æ–°é—®é¢˜åˆ†æä»¥åŠè§£å†³"></a> æ— é™æ›´æ–°é—®é¢˜åˆ†æä»¥åŠè§£å†³</h2><p>è¿™ä¸¤å¤©å†™äº†ç‚¹ä»£ç æµ‹è¯•æ—¶å‘ç°é¡µé¢å‡ºç°äº†æ— é™å¾ªç¯æ›´æ–°ï¼Œ</p><blockquote><p>Warning: Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesnâ€™t have a dependency array, or one of the dependencies changes on every render.</p></blockquote><p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><pre class="highlight"><code class="typescript"><span class="hljs-comment">// ä»è¿œç¨‹è·å–æ•°æ®</span><span class="hljs-keyword">const</span> { data } = <span class="hljs-title function_">useRequest</span>(fetchData);<span class="hljs-comment">// è§£ææ•°æ®ä¸­çš„æ ‡ç­¾</span><span class="hljs-keyword">const</span> tags = _.<span class="hljs-title function_">uniq</span>(_.<span class="hljs-title function_">concat</span>(...(data?.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> x.<span class="hljs-property">tags</span>) || [])));<span class="hljs-comment">// è®¾ç½®è¿‡æ»¤å™¨</span><span class="hljs-keyword">const</span> [filters, setFilters] = <span class="hljs-title function_">useState</span>(tags);<span class="hljs-comment">// è¿™é‡Œçš„æœ¬æ„æ˜¯åœ¨ data æ›´æ–°æ—¶æ›´æ–°è¿‡æ»¤å™¨</span><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {  <span class="hljs-title function_">setFilters</span>(tags);}, [tags]);</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘æ€»è®¤ä¸ºæ•°æ®ä»è¿œç«¯åŠ è½½ä¹‹åï¼Œ<code>tags</code>æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œ<code>setFilters(tags)</code> åº”è¯¥åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ç°å®æƒ…å†µæ˜¯ï¼Œ<code>setFilters(tags)</code>æ‰§è¡Œä¹‹åï¼Œé¡µé¢å‘ç”Ÿäº†æ¸²æŸ“ï¼Œè§¦å‘äº†<code>tags</code>çš„é‡æ–°è®¡ç®—ï¼Œå°½ç®¡æ•°ç»„å†…å®¹æ²¡æœ‰å˜åŒ–ä½†å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact å†æ¬¡æ‰§è¡Œ<code>setFilters(tags)</code>ï¼Œç„¶åå†æ¸²æŸ“å†æ‰§è¡Œâ€¦â€¦ï¼Œæœ€ç»ˆ React æ— é™çš„æ‰§è¡Œ<code>setFilters(tags)</code>ã€‚</p><p>å…¶å® tags åªæ˜¯ä¸€ä¸ªè¡ç”Ÿçš„ä¸­é—´é‡ï¼Œè¿‡æ»¤å™¨æœ¬è´¨æ˜¯è¦åœ¨ data å˜åŒ–åæ‰æ›´æ–°ï¼Œå› æ­¤è¿™æ®µä»£ç åªéœ€ç®€å•æ”¹ä¸‹å°±æ­£å¸¸äº†ã€‚</p><pre class="highlight"><code class="typescript"><span class="hljs-comment">// ä»è¿œç¨‹è·å–æ•°æ®ï¼Œåœ¨è¿™é‡Œ useRequest åªä¼šæ‰§è¡Œä¸€æ¬¡è¿œç¨‹æ•°æ®æ‹‰å–ï¼Œå› æ­¤ data ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</span><span class="hljs-keyword">const</span> { data } = <span class="hljs-title function_">useRequest</span>(fetchData);<span class="hljs-comment">// è§£ææ•°æ®ä¸­çš„æ ‡ç­¾</span><span class="hljs-keyword">const</span> tags = _.<span class="hljs-title function_">uniq</span>(_.<span class="hljs-title function_">concat</span>(...(data?.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> x.<span class="hljs-property">tags</span>) || [])));<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {  <span class="hljs-title function_">setFilters</span>(tags);}, [data]); <span class="hljs-comment">// è¿™é‡Œæ›´æ–°ä¾èµ–æ”¹ä¸º data</span></code></pre><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><p><a href="https://react.dev/reference/react/useEffect">Reference: useEffect</a><br><a href="https://zh-hans.react.dev/reference/react/useEffect">ä¸­æ–‡ Reference: useEffect</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰¯ä½œç”¨é’©å­useeffect&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å‰¯ä½œç”¨é’©å­useeffect&quot;&gt;&lt;/a&gt; å‰¯ä½œç”¨é’©å­ï¼šuseEffect&lt;/h2&gt;
&lt;p&gt;å½“éœ€è¦æ¯æ¬¡åœ¨ React ç»„ä»¶æ¸²æŸ“åæ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé’©å­æ¥</summary>
      
    
    
    
    <category term="ç¨‹åº" scheme="http://example.com/categories/%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="react" scheme="http://example.com/tags/react/"/>
    
    <category term="typescript" scheme="http://example.com/tags/typescript/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/posts/4a17b156.html"/>
    <id>http://example.com/posts/4a17b156.html</id>
    <published>2023-06-03T02:04:36.140Z</published>
    <updated>2023-06-03T02:05:01.626Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post"></a> Create a new post</h3><pre class="highlight"><code class="bash">$ hexo new <span class="hljs-string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server"></a> Run server</h3><pre class="highlight"><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files"></a> Generate static files</h3><pre class="highlight"><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites"></a> Deploy to remote sites</h3><pre class="highlight"><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
