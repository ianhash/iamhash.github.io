<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>å¼€å§‹å­¦ä¹  kubernetes</title><meta name="description" content="å­¦ä¹ ã€æ€è€ƒã€å†™ä½œã€äº«å—"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»æˆ‘åœ¨è‡ªå·±çš„ ubuntu ç³»ç»Ÿä¸Šæ­å»º kubernetes å­¦ä¹ ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œåœ¨é˜…è¯»äº†ä¸€äº›æ–‡æ¡£ä¹‹åï¼Œæˆ‘å¤§è‡´å°†æŒ‰ç…§ä»¥ä¸‹æ¸…å•æ¥é€æ­¥æ­å»ºä¸€ä¸ªæœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼Œéƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomcat å®ä¾‹ã€‚

å®‰è£… kubectl ä»¥ä¾¿åç»­å¯åŠ¨æœ¬åœ°æµ‹è¯•é›†ç¾¤åå¯ä»¥é€šè¿‡ kubectl è®¿é—®
ä½¿ç”¨ podman æä¾›å®¹å™¨æœåŠ¡
é€šè¿‡ kind åˆå§‹åŒ–å¹¶å¯åŠ¨ä¸€ä¸ª k8s é›†ç¾¤
éƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomecat å®ä¾‹

 å®‰è£… kubectl
å®‰è£…æ–¹æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://kubernetes.io/docs/tasks/tools/install-kubectl-linux/
curl -LO &quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/releas.."><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">IanHash's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">å¼€å§‹å­¦ä¹  kubernetes</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-kubectl"><span class="toc-text"> å®‰è£… kubectl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-podman"><span class="toc-text"> å®‰è£… podman</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-text"> é—®é¢˜å’Œè§£å†³åŠæ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-kind"><span class="toc-text"> å®‰è£… kind</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kind-%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-text"> kind åˆä½“éªŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4"><span class="toc-text"> åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-tomcat"><span class="toc-text"> éƒ¨ç½² tomcat</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/kubernetes"><i class="tag post-item-tag">kubernetes</i></a><a href="/tags/ubuntu"><i class="tag post-item-tag">ubuntu</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">å¼€å§‹å­¦ä¹  kubernetes</h1><time class="has-text-grey" datetime="2024-12-10T11:37:13.000Z">2024-12-10</time><article class="mt-2 post-content"><p>æœ¬æ–‡ä¸»è¦ä»‹ç»æˆ‘åœ¨è‡ªå·±çš„ ubuntu ç³»ç»Ÿä¸Šæ­å»º kubernetes å­¦ä¹ ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œåœ¨é˜…è¯»äº†ä¸€äº›æ–‡æ¡£ä¹‹åï¼Œæˆ‘å¤§è‡´å°†æŒ‰ç…§ä»¥ä¸‹æ¸…å•æ¥é€æ­¥æ­å»ºä¸€ä¸ªæœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼Œéƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomcat å®ä¾‹ã€‚</p>
<ol>
<li>å®‰è£… kubectl ä»¥ä¾¿åç»­å¯åŠ¨æœ¬åœ°æµ‹è¯•é›†ç¾¤åå¯ä»¥é€šè¿‡ kubectl è®¿é—®</li>
<li>ä½¿ç”¨ podman æä¾›å®¹å™¨æœåŠ¡</li>
<li>é€šè¿‡ kind åˆå§‹åŒ–å¹¶å¯åŠ¨ä¸€ä¸ª k8s é›†ç¾¤</li>
<li>éƒ¨ç½²å¹¶å¯åŠ¨ä¸€ä¸ª tomecat å®ä¾‹</li>
</ol>
<h2 id="å®‰è£…-kubectl"><a class="markdownIt-Anchor" href="#å®‰è£…-kubectl"></a> å®‰è£… kubectl</h2>
<p>å®‰è£…æ–¹æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/</a></p>
<pre class="highlight"><code class="bash">curl -LO <span class="hljs-string">"https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl"</span>
</code></pre>
<p>éªŒè¯ä¸€ä¸‹å®‰è£…åŒ…ï¼š</p>
<pre class="highlight"><code class="bash">curl -LO <span class="hljs-string">"https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl.sha256"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(cat kubectl.sha256)</span>  kubectl"</span> | <span class="hljs-built_in">sha256sum</span> --check
</code></pre>
<p>å¦‚æœå®‰è£…åŒ…æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œå°†è¾“å‡º <code>kubectl: OK</code>ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<pre class="highlight"><code class="bash">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
</code></pre>
<p>å¯ä»¥æ‰§è¡Œ <code>kubectl version --client</code> æ£€æŸ¥ä¸‹å®‰è£…ç‰ˆæœ¬ã€‚</p>
<h2 id="å®‰è£…-podman"><a class="markdownIt-Anchor" href="#å®‰è£…-podman"></a> å®‰è£… podman</h2>
<p>ubuntu 22.04 ä¸‹é€šè¿‡ apt åœ¨å®‰è£… podman çš„ç‰ˆæœ¬æ˜¯ 3.4.4ï¼Œè¿™ä¸ªç‰ˆæœ¬å¤ªæ—§äº†ï¼Œä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œé€šè¿‡æŸ¥ç½‘ä¸Šçš„èµ„æ–™å‘ç° homebrew ä¹Ÿæ”¯æŒ ubuntu ç³»ç»Ÿï¼Œæ‰€ä»¥è·Ÿç€ homebrew çš„å®‰è£…æŒ‡å¼•å…ˆæŠŠ homebrew å®‰è£…äº†ï¼Œç„¶åå†é€šè¿‡ homebrew å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ podmanã€‚</p>
<blockquote>
<p>è¿™ä¸ªå®‰è£…è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œå›½å†…ä½¿ç”¨ brew çš„è¯è¿˜æ˜¯éœ€è¦ç½‘ç»œåŠ é€Ÿæ‰èƒ½æœ‰ç¨å¾®å¥½çš„ä¸‹è½½ä½“éªŒï¼Œå¦‚æœä½ æœ‰å·¥å…·çš„è¯ï¼Œå¯ä»¥åœ¨ç»ˆç«¯æ‰§è¡Œ <code>export https_proxy=...</code> ä¸ºç»ˆç«¯åŠ ä¸ŠåŠ é€Ÿä»£ç†</p>
</blockquote>
<pre class="highlight"><code class="bash">brew install podman
</code></pre>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œæ³¨æ„çœ‹ brew çš„å®‰è£…æç¤ºï¼Œæˆ‘æ²¡æœ‰é€‰æ‹©ä½¿ podman éšç³»ç»Ÿå¯åŠ¨ï¼Œ</p>
<pre class="highlight"><code class="">zsh completions have been installed to:
  /home/linuxbrew/.linuxbrew/share/zsh/site-functions

To start podman now and restart at login:
  brew services start podman
Or, if you don't want/need a background service you can just run:
  /home/linuxbrew/.linuxbrew/opt/podman/bin/podman system service --time\=0
</code></pre>
<blockquote>
<p>æˆ‘æ‰‹åŠ¨å¯åŠ¨ podmanï¼Œå‡ºç° newuidmap æ²¡æœ‰å¯æ‰§è¡Œçš„æ–‡ä»¶çš„çš„é”™è¯¯ <code>exec: "newuidmap": executable file not found in $PATH</code>ï¼Œé€šè¿‡ <code>sudo apt-get install uidmap</code> è§£å†³<br>
å¦‚æœåœ¨ macos ä¸Šé€šè¿‡<code>brew install</code>å®‰è£…å¥½ podman åï¼Œéœ€è¦æ‰§è¡Œ <code>podman machine init</code>æ¥åˆå§‹åŒ–è™šæ‹Ÿæœºï¼Œå¯åŠ¨è™šæ‹Ÿæœºï¼ˆå³å¯åŠ¨å®¹å™¨æœåŠ¡ï¼‰åˆ™æ‰§è¡Œ<code>podman machine start</code>å‘½ä»¤ï¼Œè¿™ä¸ªè™šæ‹Ÿæœºè¶…è¿‡ 1Gï¼Œéœ€è¦è€å¿ƒç­‰ä¸€æ®µæ—¶é—´ã€‚</p>
</blockquote>
<p>é€šè¿‡å¯åŠ¨ä¸€ä¸ª hello-world æ¥æµ‹è¯• podman ä»¥åŠæ­£ç¡®å®‰è£…ï¼Œ</p>
<pre class="highlight"><code class="bash">podman run hello-world
</code></pre>
<p>å®ƒä¼šä» <a target="_blank" rel="noopener external nofollow noreferrer" href="http://docker.io">docker.io</a> æ‹‰å– hello-world é•œåƒå¹¶è¿è¡Œï¼Œä¸å‡ºæ„å¤–ç»ˆç«¯å°†è¾“å‡ºä¸€äº›è¡¨ç¤ºå®‰è£…æˆåŠŸçš„ä¿¡æ¯ï¼Œæ¯”å¦‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œå¦‚ä¸‹</p>
<pre class="highlight"><code class="">Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

</code></pre>
<h3 id="é—®é¢˜å’Œè§£å†³åŠæ³•"><a class="markdownIt-Anchor" href="#é—®é¢˜å’Œè§£å†³åŠæ³•"></a> é—®é¢˜å’Œè§£å†³åŠæ³•</h3>
<ol>
<li>
<p><code>failed to find plugin "bridge"</code><br>
å¯ä»¥é€šè¿‡ <code>sudo apt install containernetworking-plugins</code> è§£å†³ï¼Œä½†è¿˜æ˜¯è€é—®é¢˜ï¼Œè¿™ä¸ªå®‰è£…ä¸‹æ¥çš„ç‰ˆæœ¬æ˜¯<code>0.9</code>ï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©ä» github ä¸‹è½½æœ€æ–°çš„ release æ‰‹åŠ¨å®‰è£…ï¼Œä»ä»£ç  <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/containers/common/blob/main/pkg/config/default.go#L83">https://github.com/containers/common/blob/main/pkg/config/default.go#L83</a> ä¸­å¯ä»¥çœ‹åˆ° podman ä»ä»¥ä¸‹ç›®å½•è·å– cni æ’ä»¶:</p>
<pre class="highlight"><code class="go">	DefaultCNIPluginDirs = []<span class="hljs-type">string</span>{
	<span class="hljs-string">"/usr/local/libexec/cni"</span>,
	<span class="hljs-string">"/usr/libexec/cni"</span>,
	<span class="hljs-string">"/usr/local/lib/cni"</span>,
	<span class="hljs-string">"/usr/lib/cni"</span>,
	<span class="hljs-string">"/opt/cni/bin"</span>,
  }
</code></pre>
<p>å› æ­¤ä» github ä¸‹è½½æœ€æ–°çš„ release ä¹‹åï¼Œè§£å‹åˆ°ä»¥ä¸Šä»»æ„ç›®å½•å³å¯ã€‚</p>
<pre class="highlight"><code class="bash">sudo <span class="hljs-built_in">mkdir</span> -p /usr/local/libexec/cni
sudo tar -xzf ./Downloads/cni-plugins-linux-amd64-v1.4.0.tgz -C /usr/local/libexec/cni
</code></pre>
<p>è§£å‹ä¹‹åï¼Œæ‰§è¡Œ <code>podman system reset --force</code>åˆ·æ–°ä¸€ä¸‹ã€‚</p>
</li>
<li>
<p><code>failed to find plugin "dnsname"</code><br>
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/containers/dnsname?tab=readme-ov-file">dnsname</a> è¿™ä¸ªé¡¹ç›®å·²ç»ä¸å†ç»´æŠ¤äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/containers/netavark/">netavark</a>ï¼ŒåŒæ—¶åœ¨å‰é¢çœ‹åˆ°çš„ podman ä»£ç é‡Œæˆ‘ä»¬åŒæ ·å¯ä»¥çœ‹åˆ°æœ€æ–°çš„ podman æ”¯æŒ netavarkï¼Œ</p>
<pre class="highlight"><code class="go"> DefaultNetavarkPluginDirs = []<span class="hljs-type">string</span>{
   <span class="hljs-string">"/usr/local/libexec/netavark"</span>,
   <span class="hljs-string">"/usr/libexec/netavark"</span>,
   <span class="hljs-string">"/usr/local/lib/netavark"</span>,
   <span class="hljs-string">"/usr/lib/netavark"</span>,
 }
</code></pre>
<p>é‚£ä¹ˆç´¢æ€§æˆ‘ä»¬å°±ç”¨æœ€æ–°çš„æ–¹æ¡ˆã€‚åœ¨ netavark é¡¹ç›®ä¸‹æ‰¾åˆ°æœ€æ–°çš„ release æ–‡ä»¶ï¼Œä¸‹è½½å¹¶è§£å‹åˆ° <code>/usr/local/libexec/netavark</code>ï¼Œ</p>
<pre class="highlight"><code class="bash">sudo <span class="hljs-built_in">mkdir</span> -p /usr/local/libexec/netavark
sudo gzip -d ./netavark.gz
sudo <span class="hljs-built_in">cp</span> -fr netavark /usr/local/libexec/netavark
sudo <span class="hljs-built_in">chmod</span> +x /usr/local/libexec/netavark/netavark
</code></pre>
<p>ä¸ºäº†è®© podman èƒ½ä½¿ç”¨ netavarkï¼Œéœ€è¦ä½œä¸ªé…ç½®ï¼Œé…ç½®å‚è€ƒï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/containers/common/blob/main/docs/containers.conf.5.md%EF%BC%8C%E6%88%91%E9%80%89%E6%8B%A9%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%60$HOME/.config/containers/containers.conf%60%E5%B9%B6%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8A%A0%E5%85%A5%E4%B8%80%E8%A1%8C%E9%85%8D%E7%BD%AE:">https://github.com/containers/common/blob/main/docs/containers.conf.5.mdï¼Œæˆ‘é€‰æ‹©åˆ›å»ºæ–‡ä»¶`$HOME/.config/containers/containers.conf`å¹¶åœ¨å…¶ä¸­åŠ å…¥ä¸€è¡Œé…ç½®:</a></p>
<pre class="highlight"><code class="ini"><span class="hljs-attr">network_backend</span>=<span class="hljs-string">"netavark"</span>
</code></pre>
</li>
</ol>
<p>kind é»˜è®¤ä½¿ç”¨ docker ä½œä¸ºå®¹å™¨å¼•æ“ï¼Œä¸ºäº†ä½¿ kind èƒ½ä½¿ç”¨ podmanï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸‹ shellï¼Œæˆ‘ä½¿ç”¨ zshï¼Œå› æ­¤åœ¨ .zshrc ä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="highlight"><code class="bash"><span class="hljs-comment"># kind with podman</span>
<span class="hljs-built_in">alias</span> docker=podman
KIND_EXPERIMENTAL_PROVIDER=podman

</code></pre>
<h2 id="å®‰è£…-kind"><a class="markdownIt-Anchor" href="#å®‰è£…-kind"></a> å®‰è£… kind</h2>
<p>å¯¹äº macos å¯ä»¥ç›´æ¥ä½¿ç”¨<code>brew install kind</code>æ¥å®‰è£…ï¼Œè€Œåœ¨ Ubuntu ä¸‹å»ºè®®é€šè¿‡<code>go get</code>ï¼Œæ‰€ä»¥å®‰è£… kind ä¹‹å‰éœ€è¦é¦–å…ˆå®‰è£… go å¹¶å®Œæˆç›¸åº”çš„è®¾ç½®ã€‚</p>
<p>åŒæ ·å¯ä»¥é€šè¿‡ apt æ¥å®‰è£… goï¼Œæˆ‘æ˜¯ä»å®˜ç½‘ä¸‹è½½ go çš„å®‰è£…åŒ…å®‰è£…çš„ï¼Œæ— è®ºå¦‚ä½•å®‰è£…ï¼Œä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„è®¾ç½®æ˜¯<code>GOPROXY</code>ã€‚</p>
<pre class="highlight"><code class="bash">go <span class="hljs-built_in">env</span> -w GOPROXY=https://goproxy.cn,direct
</code></pre>
<p>ç„¶åå°±å¯ä»¥å®‰è£… kind äº†ï¼Œ</p>
<pre class="highlight"><code class="bash">go install sigs.k8s.io/kind@v0.20.0
</code></pre>
<p>go ä¼šå°† kind ä»¥åŠç›¸å…³çš„ä¾èµ–å…¨éƒ¨å®‰è£…åˆ° GOPATH ä¸‹ï¼Œè€Œ GOPATH é»˜è®¤å°±æ˜¯ä½  HOME ç›®å½•ä¸‹çš„ go æ–‡ä»¶å¤¹ï¼Œå¯ä»¥é€šè¿‡<code>go env GOPATH</code>æ¥æŸ¥çœ‹ï¼Œå¯ä»¥åœ¨<code>.bashrc</code>æˆ–è€…<code>.zshrc</code>ä¸­åŠ å…¥ä¸€è¡Œï¼š</p>
<pre class="highlight"><code class="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HOME</span>/go/bin
</code></pre>
<p>é‡å¯ç»ˆç«¯å·¥å…·ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨ kind å‘½ä»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ <code>kind version</code> æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<h2 id="kind-åˆä½“éªŒ"><a class="markdownIt-Anchor" href="#kind-åˆä½“éªŒ"></a> kind åˆä½“éªŒ</h2>
<p>é€šè¿‡<code>kind --help</code>å¯ä»¥å¤§è‡´æµè§ˆä¸‹ kind æœ‰å“ªäº›å‘½ä»¤é€‰é¡¹å¯ç”¨ã€‚</p>
<pre class="highlight"><code class="">kind creates and manages local Kubernetes clusters using Docker container 'nodes'

Usage:
  kind [command]

Available Commands:
  build       Build one of [node-image]
  completion  Output shell completion code for the specified shell (bash, zsh or fish)
  create      Creates one of [cluster]
  delete      Deletes one of [cluster]
  export      Exports one of [kubeconfig, logs]
  get         Gets one of [clusters, nodes, kubeconfig]
  help        Help about any command
  load        Loads images into nodes
  version     Prints the kind CLI version

Flags:
  -h, --help              help for kind
      --loglevel string   DEPRECATED: see -v instead
  -q, --quiet             silence all stderr output
  -v, --verbosity int32   info log verbosity, higher value produces more output
      --version           version for kind

Use "kind [command] --help" for more information about a command.
</code></pre>
<blockquote>
<p>è¿™é‡Œæœ‰æ„æ€çš„æ˜¯é€šè¿‡ <code>kind completion</code> å¯ä»¥çœ‹åˆ°ä¸åŒç»ˆç«¯ä¸‹å‘½ä»¤è‡ªåŠ¨å¡«å……çš„æ–¹æ³•ï¼Œå»ºè®®è·Ÿç€è¯´æ˜é…ç½®ä¸€ä¸‹ï¼Œåœ¨ç»ˆç«¯ä¸‹è¾“å…¥ç›¸å…³å‘½ä»¤å¯ä»¥è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p>
</blockquote>
<p>è¿™ä¸ªæ—¶å€™ä½¿ç”¨<code>kind get clusters</code>å¯ä»¥çœ‹åˆ°å‘½ä»¤ kind å·²ç»ä½¿ç”¨ podman ä½œä¸ºå®¹å™¨å¼•æ“å¹¶ä¸”ç›®å‰è¿˜æ²¡æœ‰ä»»ä½•é›†ç¾¤ã€‚</p>
<pre class="highlight"><code class="">enabling experimental podman provider
No kind clusters found.
</code></pre>
<p>ä¸ºäº†ä»¥æ™®é€šè´¦æˆ·è¿è¡Œ kindï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€äº›é…ç½®ï¼Œæˆ‘å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://kind.sigs.k8s.io/docs/user/rootless/">https://kind.sigs.k8s.io/docs/user/rootless/</a> è¿›è¡Œé…ç½®ä½†æ— æ³•æˆåŠŸåˆ›å»ºé›†ç¾¤ã€‚é”™è¯¯å¦‚ä¸‹ï¼š</p>
<pre class="highlight"><code class="bash">(base) âœ  ~ kind create cluster
enabling experimental podman provider
ERROR: failed to create cluster: running kind with rootless provider requires setting systemd property <span class="hljs-string">"Delegate=yes"</span>, see https://kind.sigs.k8s.io/docs/user/rootless/
</code></pre>
<p>æˆ‘æš‚æ—¶è¿˜ä¸å¤ªæ‡‚<code>systemd</code>é‚£å¥—ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ²¡æœ‰è°ƒæŸ¥æ¸…é™¤è¿™ä¸ªé—®é¢˜çš„åŸå› ï¼Œæˆ‘æƒ³æœªæ¥å†å¯¹ systemd è¿›è¡Œç³»ç»Ÿæ€§çš„å­¦ä¹ ï¼Œç°åœ¨é¦–è¦å·¥ä½œæ˜¯è§£å†³ kind åˆ›å»ºé›†ç¾¤çš„é—®é¢˜ã€‚æˆ‘åœ¨æŸ¥é˜…äº†ç½‘ä¸Šå¾ˆå¤šæ–‡æ¡£ä¹‹ååœ¨è¿™é‡Œæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes-sigs/kind/issues/2916">Running with rootless podman seems not to respect property Delegate=yes</a></p>
<p>ä¼¼ä¹æŒ‰ç…§ kind æ–‡æ¡£ä¸­è¯´çš„åœ¨<code>/etc/systemd/system/user@.service.d/delegate.conf</code>æ–‡ä»¶ä¸­é…ç½®çš„<code>Delegate=yes</code>æ²¡æœ‰ç”Ÿæ•ˆï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºé›†ç¾¤æ—¶åŠ ä¸Š<code>--property=Delegate=yes</code>å‚æ•°ï¼Œå³</p>
<pre class="highlight"><code class="bash">systemd-run --user --property=Delegate=<span class="hljs-built_in">yes</span> kind create cluster
</code></pre>
<p>ç°åœ¨ç»ˆäºå¯ä»¥çœ‹åˆ°ç†æƒ³çš„ç»“æœäº†ï¼š</p>
<pre class="highlight"><code class="">(base) âœ  ~ systemd-run --scope  --user --property=Delegate=yes kind create cluster
Running as unit: run-r3e7e2ade31574b7ba03fece7b1b70d02.scope; invocation ID: 82c73452ecb240be9fc5f8cad084b879
enabling experimental podman provider
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.27.3) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a nice day! ğŸ‘‹
</code></pre>
<p>ä»è¿™ä¸ªè¾“å‡ºä¿¡æ¯çœ‹ä¸ä»…åˆ›å»ºäº†ä¸€ä¸ªåä¸º kind çš„é›†ç¾¤ï¼Œè¿˜ä¸ºæˆ‘ä»¬æŠŠ kubectl ä¹Ÿé…ç½®å¥½äº†ï¼Œç°åœ¨å¯ä»¥æ£€æŸ¥ä¸‹ã€‚</p>
<pre class="highlight"><code class="">(base) âœ  ~ kind get clusters
enabling experimental podman provider
kind
(base) âœ  ~ kind get nodes
enabling experimental podman provider
kind-control-plane
(base) âœ  ~ kubectl get node
NAME                 STATUS   ROLES           AGE    VERSION
kind-control-plane   Ready    control-plane   7m7s   v1.27.3
</code></pre>
<h2 id="åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤"><a class="markdownIt-Anchor" href="#åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤"></a> åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤</h2>
<p>ä¸€ä¸ªæµ‹è¯•é›†ç¾¤æ€ä¹ˆè¯´ä¹Ÿè‡³å°‘è¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª yaml æ–‡ä»¶é…ç½®é›†ç¾¤ã€‚</p>
<pre class="highlight"><code class="yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">Cluster</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kind.x-k8s.io/v1alpha4</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">kindtest</span>
<span class="hljs-attr">nodes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">control-plane</span>
    <span class="hljs-attr">kubeadmConfigPatches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">|
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            node-labels: "ingress-ready=true"
</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">worker</span>
</code></pre>
<p>æ‰§è¡Œ kind åˆ›å»ºé›†ç¾¤çš„å‘½ä»¤</p>
<pre class="highlight"><code class="bash">systemd-run --scope  --user --property=Delegate=<span class="hljs-built_in">yes</span> kind create cluster --config=./kindtest.yaml
</code></pre>
<p>ç¨å¾®ç­‰å¾…è¿‡å kind ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºåŒ…å«ä¸€ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œé€šè¿‡ <code>kubectl get nodes</code> æ£€æŸ¥ä¸€ä¸‹:</p>
<pre class="highlight"><code class="bash">âœ  Devops kubectl get nodes
NAME                     STATUS   ROLES           AGE   VERSION
kindtest-control-plane   Ready    control-plane   18m   v1.27.3
kindtest-worker          Ready    &lt;none&gt;          18m   v1.27.3
</code></pre>
<p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å½“å‰é›†ç¾¤æœ‰é‚£äº› podï¼Œæˆ‘é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŠŠ pod çš„ namespace/name/nodeName è¾“å‡ºæ¥</p>
<pre class="highlight"><code class="bash">kubectl get pods -A -o jsonpath=<span class="hljs-string">"{range .items[*]}{.metadata.namespace}{'\t'}{.metadata.name}{'\t'}{.spec.nodeName}{'\n'}{end}"</span>
</code></pre>
<p>è¾“å‡ºç»“æœ:</p>
<pre class="highlight"><code class="">kube-system	coredns-5d78c9869d-n6qjr	kindtest-control-plane
kube-system	coredns-5d78c9869d-v9bkm	kindtest-control-plane
kube-system	etcd-kindtest-control-plane	kindtest-control-plane
kube-system	kindnet-8r4h8	kindtest-control-plane
kube-system	kindnet-n4d6j	kindtest-worker
kube-system	kube-apiserver-kindtest-control-plane	kindtest-control-plane
kube-system	kube-controller-manager-kindtest-control-plane	kindtest-control-plane
kube-system	kube-proxy-bksh8	kindtest-control-plane
kube-system	kube-proxy-vzv5p	kindtest-worker
kube-system	kube-scheduler-kindtest-control-plane	kindtest-control-plane
local-path-storage	local-path-provisioner-6bc4bddd6b-8w9jv	kindtest-control-plane
</code></pre>
<p>é€šè¿‡è¿™äº›è¾“å‡ºå¯ä»¥äº†è§£åˆ°èŠ‚ç‚¹<code>kindtest-control-plane</code> åŒ…å«äº† k8s è¿è¡Œçš„å¿…è¦ç»„å»ºåŒ…æ‹¬ apiserver, etcd, kubeproxy, kube-scheduler ç­‰ã€‚</p>
<h2 id="éƒ¨ç½²-tomcat"><a class="markdownIt-Anchor" href="#éƒ¨ç½²-tomcat"></a> éƒ¨ç½² tomcat</h2>
<p>åœ¨åˆ›å»º depleymnent ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª namespaceï¼Œ</p>
<pre class="highlight"><code class="bash">kubectl create namespace k8slearn
</code></pre>
<p>ç„¶åå‡†å¤‡ deployment é…ç½®ï¼Œå¹¶æ‰§è¡Œ<code>kubectl apply -f ./k8slearn-tomcatapp-deployment.yaml</code></p>
<pre class="highlight"><code class="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">get-started-with-k8s</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">k8slearn</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">k8slearn</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">k8slearn</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">tomcat</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">main</span>
          <span class="hljs-attr">ports:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>
</code></pre>
<p>ä¸å‡ºæ„å¤–ï¼Œç¨ç­‰ä¸€ä¼šå„¿ä¸€ä¸ª pod å°±ä¼šåˆ›å»ºå‡ºæ¥ã€‚</p>
<pre class="highlight"><code class="bash">(base) âœ  kubectl get pod -n k8slearn
NAME                                    READY   STATUS    RESTARTS   AGE
get-started-with-k8s-6487fc8787-tp5bh   1/1     Running   0          6m25s

</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/posts/3c566753.html" title="install dashboard in kind cluster"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: install dashboard in kind cluster</span></a><a class="button is-default" href="/posts/8ca469cd.html" title="get started with rust"><span class="has-text-weight-semibold">Next: get started with rust</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="ianhash/ianhash.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/ianhash"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright Â©</span><span> IanHash 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script>
        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        const hasAttr = (e,a) => a.some(_=> e.attr(_)!==undefined);
        $('a').each(function() {
          const $this = $(this);
          if(hasAttr($this,["data-fancybox","ignore-external-link"])) return;
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== '' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body></html>